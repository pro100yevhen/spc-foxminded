/version: '3.7'
services:
  ngodb:
    container_name: ngodatabase
    image: mcr.microsoft.com/mssql/server:2019-latest
    restart: always
    ports:
      - "1433:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=37Y5Nb8uTo2
      - MSSQL_COLLATION=Cyrillic_General_CI_AS
    volumes:
      - /home/docker/skarb/ngo-db:/var/opt/mssql
    healthcheck:
      test: /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "37Y5Nb8uTo2" -Q "CREATE DATABASE SkarbNgoDB"
      interval: 10s
      timeout: 3s
      retries: 10
    networks:
      - compose-demo_default
      - scarb
  back:
    container_name: backend
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9080:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
      - SPRING_MAIL_HOST=http://mailhog
#      - SPRING_H2_CONSOLE_ENABLED=true
      - STORAGE_BLOBS_MINIO_SERVICE_ENDPOINT=http://storage:9001
#      - H2_SERVER_TCP_PORT=9189
#      - H2_SERVER_ENABLED=true
      - VIRTUAL_HOST=testskarbback.foxminded.ua
      - REDIRECT=testskarbback.foxminded.ua
      - LETSENCRYPT_HOST=testskarbback.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    volumes:
      - /home/docker/skarb/ngo-backend:/app
    command: ['java', '-jar', '/app/app.jar']
    depends_on:
      - 'ngodb'
    networks:
      - compose-demo_default
      - scarb
  front:
    container_name: frontend
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9081:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
      - VIRTUAL_HOST=testskarb.foxminded.ua
      - REDIRECT=testskarb.foxminded.ua
      - LETSENCRYPT_HOST=testskarb.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    volumes:
      - /home/docker/skarb/ngo-frontend:/app
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - compose-demo_default
      - scarb
  admin:
    container_name: adm
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9082:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
    volumes:
      - /home/docker/skarb/ngo-admin:/app
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - compose-demo_default
      - scarb
  conf:
    container_name: config
    image: 'openjdk:11-jre-slim'
    restart: always
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_CLOUD_CONFIG_SERVER_NATIVE_SEARCH-LOCATIONS=file:///config
      - SPRING_PROFILES_ACTIVE=native
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
    volumes:
      - /home/docker/skarb/ngo-cloud-config-server:/app
      - /home/docker/skarb/docker/configs:/config
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - scarb
      - compose-demo_default
  sto:
    container_name: storage
    image: 'minio/minio'
    command: server /data
    ports:
    - "9001:9000"
    environment:
      - MINIO_ROOT_USER=SECRETUSERNAME
      - MINIO_ROOT_PASSWORD=SECRETPASSWORD
    networks:
      - scarb
      - compose-demo_default
  mail:
    image: 'mailhog/mailhog:latest'
    container_name: mailhog_server
    restart: always
    ports:
      - "1025:1025"
      - "8025:8025"
    environment:
      - VIRTUAL_PORT=8025
      - VIRTUAL_HOST=testskarbmail.foxminded.ua
      - REDIRECT=testskarbmail.foxminded.ua
      - LETSENCRYPT_HOST=testskarbmail.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    networks:
      - scarb
      - compose-demo_default
networks:
  compose-demo_default:
    external: true
  scarb:
1:29
/
version: '3.7'
services:
  ngodb:
    container_name: ngodatabase
    image: mcr.microsoft.com/mssql/server:2019-latest
    restart: always
    ports:
      - "1433:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=37Y5Nb8uTo2
      - MSSQL_COLLATION=Cyrillic_General_CI_AS
    volumes:
      - /home/docker/skarb/ngo-db:/var/opt/mssql
    healthcheck:
      test: /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "37Y5Nb8uTo2" -Q "CREATE DATABASE SkarbNgoDB"
      interval: 10s
      timeout: 3s
      retries: 10
    networks:
      - compose-demo_default
      - scarb
  back:
    container_name: backend
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9080:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
      - SPRING_MAIL_HOST=http://mailhog
#      - SPRING_H2_CONSOLE_ENABLED=true
      - STORAGE_BLOBS_MINIO_SERVICE_ENDPOINT=http://storage:9001
#      - H2_SERVER_TCP_PORT=9189
#      - H2_SERVER_ENABLED=true
      - VIRTUAL_HOST=testskarbback.foxminded.ua
      - REDIRECT=testskarbback.foxminded.ua
      - LETSENCRYPT_HOST=testskarbback.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    volumes:
      - /home/docker/skarb/ngo-backend:/app
    command: ['java', '-jar', '/app/app.jar']
    depends_on:
      - 'ngodb'
    networks:
      - compose-demo_default
      - scarb
  front:
    container_name: frontend
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9081:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
      - VIRTUAL_HOST=testskarb.foxminded.ua
      - REDIRECT=testskarb.foxminded.ua
      - LETSENCRYPT_HOST=testskarb.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    volumes:
      - /home/docker/skarb/ngo-frontend:/app
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - compose-demo_default
      - scarb
  admin:
    container_name: adm
    image: 'openjdk:11-jre-slim'
    restart: always
    ports:
      - "9082:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SKARB_ENCRYPTION_KEY='$karb_Ng0'
      - SPRING_CLOUD_CONFIG_URI=http://config
      - SPRING_PROFILES_ACTIVE=local
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
    volumes:
      - /home/docker/skarb/ngo-admin:/app
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - compose-demo_default
      - scarb
  conf:
    container_name: config
    image: 'openjdk:11-jre-slim'
    restart: always
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_CLOUD_CONFIG_SERVER_NATIVE_SEARCH-LOCATIONS=file:///config
      - SPRING_PROFILES_ACTIVE=native
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
    volumes:
      - /home/docker/skarb/ngo-cloud-config-server:/app
      - /home/docker/skarb/docker/configs:/config
    command: ['java', '-jar', '/app/app.jar']
    networks:
      - scarb
      - compose-demo_default
  sto:
    container_name: storage
    image: 'minio/minio'
    command: server /data
    ports:
    - "9001:9000"
    environment:
      - MINIO_ROOT_USER=SECRETUSERNAME
      - MINIO_ROOT_PASSWORD=SECRETPASSWORD
    networks:
      - scarb
      - compose-demo_default
  mail:
    image: 'mailhog/mailhog:latest'
    container_name: mailhog_server
    restart: always
    ports:
      - "1025:1025"
      - "8025:8025"
    environment:
      - VIRTUAL_PORT=8025
      - VIRTUAL_HOST=testskarbmail.foxminded.ua
      - REDIRECT=testskarbmail.foxminded.ua
      - LETSENCRYPT_HOST=testskarbmail.foxminded.ua
      - LETSENCRYPT_EMAIL=admin@foxminded.ua
    networks:
      - scarb
      - compose-demo_default
networks:
  compose-demo_default:
    external: true
  scarb: