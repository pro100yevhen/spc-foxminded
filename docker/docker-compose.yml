services:
  db:
    container_name: foxminded-activity-database
    image: postgres:16.4
    restart: always
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=P@ssw0rd1234!
      - POSTGRES_USER=admin
      - POSTGRES_DB=activity
    networks:
      - shvirid

  back:
    container_name: backend
    image: 'openjdk:21-slim'
    restart: always
    ports:
      - "9080:80"
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_MAIN_BANNER-MODE=off
      - SPRING_CLOUD_CONFIG_URI=http://config:80
      - SPRING_PROFILES_ACTIVE=local
    volumes:
      - /D:/Downloads/activity/back:/app
    command: ['java', '-jar', '/app/app.jar']
    depends_on:
      db:
        condition: service_started
      config:
        condition: service_started
    networks:
      - shvirid

  config:
    container_name: config
    image: 'openjdk:11-jre-slim'
    restart: always
    environment:
      - SERVER_PORT=80
      - SERVER_ADDRESS=0.0.0.0
      - SPRING_CLOUD_CONFIG_SERVER_NATIVE_SEARCH_LOCATIONS=file:///config
      - SPRING_PROFILES_ACTIVE=native
      - SPRING_CLOUD_CONFIG_DISCOVERY_ENABLED=false
      - SPRING_CLOUD_DISCOVERY_ENABLED=false
    volumes:
      - /D:/Downloads/activity/config:/app
      - /D:/Downloads/activity/config/configs:/config
    command: [ 'java', '-jar', '/app/app.jar' ]
    networks:
      - shvirid

networks:
  shvirid: